---
slug: cs-deadlock
title: κµμ°© μƒνƒ(deadlock)
tags: [ cs, java ]
---

κµμ°© μƒνƒ(deadlock) λ” λ‘ κ° μ΄μƒμ μ‘μ—…μ΄ μ„λ΅ μƒλ€λ°©μ μ‘μ—…μ΄ λλ‚κΈ°λ§μ„ κΈ°λ‹¤λ¦¬κ³  μμ–΄ κ²°κ³Όμ μΌλ΅ μ•„λ¬΄κ²ƒλ„ μ™„λ£λμ§€ λ»ν•λ” μƒνƒλ¥Ό μλ―Έν•©λ‹λ‹¤. κ°€λ Ή, A ν”„λ΅μ„Έμ¤κ°€ μμ› Aλ¥Ό κ°€μ§€κ³  μμ› Bλ¥Ό ν•„μ”λ΅ ν•©λ‹λ‹¤. κ·Έλ¦¬κ³ , B ν”„λ΅μ„Έμ¤λ” μμ› Bλ¥Ό κ°€μ§€κ³  μμ› Aκ°€ ν•„μ”ν•  λ• λ‘ κ°μ ν”„λ΅μ„Έμ¤λ” κµμ°© μƒνƒμ— λΉ μ Έ μ–΄λ μ‘μ—…λ„ μ§„ν–‰ν•  μ μ—†λ” μƒν™©μ΄ λ©λ‹λ‹¤.

## β”οΈ κµμ°© μƒνƒκ°€ λ°μƒν•λ” μ΅°κ±΄μ€? π¤”
4κ°€μ§€ μ΅°κ±΄(μƒνΈ λ°°μ , μ μ  λ€κΈ°, λΉ„μ„ μ , μ›ν• λ€κΈ°)μ΄ λ¨λ‘ λ§μ΅±ν•λ” κ²½μ°, κµμ°© μƒνƒμ— λΉ μ§ μ μμµλ‹λ‹¤.

### 1) μƒνΈ λ°°μ (mutual exclusion)
ν• ν”„λ΅μ„Έμ¤κ°€ μ‚¬μ©ν•λ” μμ›μ„ λ‹¤λ¥Έ ν”„λ΅μ„Έμ¤κ°€ μ‚¬μ©ν•  μ μ—†λ” κ²½μ°λ¥Ό μλ―Έν•©λ‹λ‹¤.

### 2) μ μ  λ€κΈ°(hold and wait)
μμ›μ„ ν• λ‹Ήλ°›μ€ μƒνƒμ—μ„ λ‹¤λ¥Έ μμ›μ„ ν• λ‹Ήλ°›κΈ°λ¥Ό κΈ°λ‹¤λ¦¬λ” μƒνƒλ¥Ό μλ―Έν•©λ‹λ‹¤.

### 3) λΉ„μ„ μ (non-preemption)
μμ›μ΄ κ°•μ μ μΌλ΅ ν•΄μ λ  μ μ—†μΌλ©° μ μ ν•κ³  μλ” ν”„λ΅μ„Έμ¤μ μ‘μ—…μ΄ λλ‚ μ΄ν›„μ—λ§ ν•΄μ λλ” κ²ƒμ„ μλ―Έν•©λ‹λ‹¤.

### 4) μ›ν• λ€κΈ°(circular wait)
ν”„λ΅μ„Έμ¤λ“¤μ΄ μ›μ ν•νƒλ΅ μμ›μ„ λ€κΈ°ν•λ” κ²ƒμ„ μλ―Έν•©λ‹λ‹¤.

## β”οΈ μλ°”μ—μ„ κµμ°© μƒνƒλ” μ–΄λ–»κ² ν•΄κ²°ν•  μ μμ„κΉ? π€
```java
// thread 1
synchronized (resource1) { 
  synchronized(resource2) { ... }
}

// thread 2
synchronized (resource2) { 
  synchronized(resource1) { ... }
}
```
μλ¥Ό λ“¤μ–΄, μλ°”μ syncronized ν‚¤μ›λ“λ΅ μΈν• κµμ°© μƒνƒκ°€ λ°μƒν–λ‹¤κ³  κ°€μ •ν•΄λ³΄κ² μµλ‹λ‹¤. μ„μ™€ κ°™μ€ κ²½μ°μ—λ” μ™Έλ¶€ synchronized λΈ”λ΅ λ‚΄λ¶€μ— synchronized λΈ”λ΅μ„ ν¬ν•¨ν•μ§€ μ•λ„λ΅ κ°μ„ ν•μ—¬ <mark>**μ μ  λ€κΈ° μ΅°κ±΄μ„ μ κ±°**</mark>ν•μ—¬ κµμ°© μƒνƒλ¥Ό ν•΄κ²°ν•  μ μμµλ‹λ‹¤.

μ΄μ™Έμ—λ„ ReentrantLockμ„ μ‚¬μ©ν•λ” κ²½μ°μ—λ” tryLock() λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ νƒ€μ„μ•„μ›ƒμ„ μ„¤μ •ν•κ±°λ‚, lockInterruptibly() λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ λ°λ“λ½μ΄ λ°μƒν•λ” κ²½μ°, μΈν„°λ½νΈλ¥Ό ν†µν•΄ μ¤λ λ“λ¥Ό κΉ¨μΈ μ μμµλ‹λ‹¤.

μ •λ¦¬ν•μλ©΄ κµμ°© μƒνƒκ°€ λ°μƒν•λ” <mark>**4κ°€μ§€ μ΅°κ±΄ μ¤‘ ν•λ‚λ¥Ό μ¶©μ΅±ν•μ§€ λ»ν•κ² ν•κ±°λ‚**</mark>, λ€κΈ°ν•λ” κ²½μ° <mark>**λ¬΄ν•μ • κΈ°λ‹¤λ¦¬μ§€ μ•λ” λ°©μ‹**</mark>μΌλ΅ κµμ°© μƒνƒλ¥Ό ν’€μ–΄λ³Ό μ μμµλ‹λ‹¤.