---
slug: cs-load-balancing
title: 로드 밸런싱
tags: [ cs, network ]
---

로드 밸런싱이란 <mark>**애플리케이션을 지원하는 리소스 풀에 들어오는 네트워크 트래픽(들어오는 요청)을 균등하게 분산하는 것**</mark>을 의미합니다. 이를 수행하는 로드 밸런서는 애플리케이션 서버 앞단에 위치하며 클라이언트 요청을 지시하고 제어합니다. 이를 통해서 애플리케이션의 가용성, 확장성, 보안 및 성능을 확보할 수 있습니다.

## ✔️ 로드 밸런싱 기법(알고리즘)

### 📌 라운드 로빈(Round Robin)
모든 요청이 순서대로 처리되는 방식입니다. 서버가 3대(A, B, C)가 존재하면 요청은 ABCABC 순서대로 전달됩니다. 모든 서버의 처리 능력이 동등하고, 요청의 고른 분산이 중요한 경우 고려해볼 수 있습니다. 구현이 쉬우며 고른 분산을 보장한다는 것이 장점입니다. 하지만, 서버 부하나 응답 시간을 고려하지 않고 서버의 처리 능력이 다른 경우 비효율적이라는 것이 단점입니다.

### 📌 가중치 라운드 로빈(Weighted Round Robin)
라운드 로빈 방식에 가중치라는 개념을 추가합니다. 각 서버는 처리 능력과 가용 자원에 따라서 가중치를 할당 받게 됩니다. 그리고, 라운드 로빈 방식을 사용하되 가중치가 높은 서버는 가중치에 비례하여 상대적으로 더욱 많은 요청을 받게 됩니다.

![Weighted Round Robin](img/weighted-round-robin.png)
라운드 로빈보다 상대적으로 구현이 복잡하지만 각 서버의 처리 능력을 고려하지 않는다는 라운드 로빈 방식의 단점을 개선합니다. 하지만, 여전히 <mark>**서버의 상태를 고려하지 않는 방식**</mark>이라는 점을 유의해야합니다.

### 📌 최소 연결(Least Connections)
각 서버의 활성 연결 수를 모니터링하고 있는 경우에 사용할 수 있습니다. <mark>**가장 적은 활성 연결이 존재하는 서버에게 요청을 전달하는 방식**</mark>입니다. 각 서버의 처리 능력이 다른 경우에는 적합하지 않을 수 있습니다. 처리 능력이 큰 서버는 상대적으로 활성 연결을 더욱 많이 수립할 수 있기 때문입니다. 최소 연결 방식은 각 서버의 처리 능력이 비슷하지만 특정 이유로 한 서버에 동시 연결 수가 많아 지는 상황이 존재하는 경우 고려해볼 수 있습니다.

### 📌 가중치 최소 연결(Weighted Least Connections)
로드 밸런싱 대상에 상대적으로 처리 능력이 큰 서버가 존재하는 경우에는 라운드 로빈과 마찬가지로 가중치라는 개념을 사용해볼 수 있습니다.

이 방식은 두 가지 주요 요소를 고려하여 동작합니다.
- 연결 수(Connections)
- 현재 각 서버에 연결된 클라이언트의 수입니다.
- 가중치(Weight)
- 각 서버가 가진 처리 능력이나 성능을 나타내는 값입니다.
- 처리 능력이 뛰어난 서버에 높은 가중치를 부여합니다.

이 두 요소를 함께 고려하여 요청을 가장 효율적으로 처리할 수 있는 서버를 선택합니다.

예를 들어 다음과 같은 서버가 있다고 가정합니다.


| 서버 | 가중치(Weight) | 현재 연결 수(Connections) |
|----|-------------|----------------------|
| A  | 3           | 9                    |
| B  | 2           | 4                    |
| C  | 1           | 1                    |

이때 다음 요청이 들어오면 “연결 수 ÷ 가중치” 값이 가장 작은 서버에 할당됩니다.
- A 서버: 9 ÷ 3 = 3
- B 서버: 4 ÷ 2 = 2
- C 서버: 1 ÷ 1 = 1

👉🏻 이 경우 값이 가장 작은 C 서버가 선택됩니다.

### 📌 최소 응답 시간(Least Response Time)
각 서버의 응답 시간을 모니터링하고 있는 경우에 사용할 수 있습니다. 응답 시간이 가장 빠른 서버에 요청을 전달하는 방식입니다. 서버들마다 응답 시간이 다양할 경우, 가장 빠른 서버에 요청을 전달하여 사용자 경험을 개선하는데 도움이 될 수 있습니다. 응답 시간을 기반으로 하기 때문에 서버의 부하 상태, 활성 연결 수와 같은 다른 요소들을 고려해야하는 경우에는 적합하지 않을 수 있습니다.

### 📌 IP 해시
클라이언트 요청의 IP를 기반으로 요청을 전달합니다. IP를 이용해 구한 해시값을 기반으로 요청을 전달할 서버를 결정합니다. IP 해시 방식은 클라이언트와 서버 간의 친화성 유지에 초점을 맞춘 방식으로 클라이언트의 상태에 관리에 용이하다는 장점이 있습니다. 하지만, 상황에 따라서 부하가 균등하게 이루어지지 않는다는 단점이 존재합니다.

![IP Hash Load Balancing](img/ip-hash-load-balancing.png)

#### 장점
- 특정 IP에서 오는 요청은 항상 같은 서버로 보내지기 때문에, 서버와 클라이언트 간의 상태 유지(친화성) 에 유리
- 로그인 상태나 세션 관리가 용이

#### 단점
- IP 주소 기반으로 서버를 고정적으로 할당하다 보면 서버 부하가 고르게 분산되지 않을 수 있음.  
  (클라이언트 IP에 따라 트래픽 분포가 다를 경우 서버 부하가 고르지 않게 됨)
- 클라이언트 IP 주소가 고정되어 있으므로, 트래픽이 많은 IP의 요청이 특정 서버에만 집중될 수 있음